<html>
	<head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="audiosynth/audiosynth.js"></script>
	<script src="js/raf.js"></script>
	<script src="js/Class.js"></script>
	<script src="js/Instrument.js"></script>
	<script src="js/ClientController.js"></script>
	<script src="js/Renderer.js"></script>
	<script>

	var output = null;
	var socket = null;
	var colors = [];
	var timer;
	var minX = 0;
	var maxX = 0;
	var minY = 0;
	var maxY = 0;

	var controller = new ClientController();
	var renderer = new Renderer(controller.clients);
	var renderInterval = -1;

	function onload()
	{     
		output = document.getElementById('output');
		socket = io.connect('http://22.155.0.3:8000');

		setBounds();
		window.onresize = setBounds;

		socket.on("connect", function() {
			socket.emit("id", "slave");
		});

		socket.on("cmd-client", function(data) {

			var id = data.id;
			var cmd = data.cmd;

			switch(cmd)
			{

				case "hs":
					
					instrument = controller.addClient(output, id, data.color);
					colors[id] = data.color;
					break;

				case "down":

					if (!controller.hasActiveClients())
					{
						renderer.start();
						timer = setInterval(stepAudio, 80);
					}

					controller.execute(id, ClientController.START);
					break;

				case "up":

					controller.execute(id, ClientController.STOP);

					if (!controller.hasActiveClients())
					{
						renderer.stop();
						clearInterval(timer);
					}					
					break;					

				case "disconnect":
					controller.destroyClient(id);
					break;
			}
		});

		
	}    	

	function stepAudio () {

		var c = null;
		for (var i in controller.clients) {

			c = controller.clients[i];
			if (c.active)
				c.playNextNote();
		}
	}


	function setBounds(event) {

		minX = ((window.innerWidth / 2) * -1);
		maxX = (window.innerWidth / 2) - 50;
		minY = ((window.innerHeight / 2 ) * -1) + 50;
		maxY = (window.innerHeight / 2);		
	}

	</script>
	<link rel="stylesheet" href="css/slave.css" />

	</head>
	<body onload="onload();">
			<div id="output"></div>
	</body>
</html>
