<html>
	<head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="audiosynth/audiosynth.js"></script>
	<script src="js/Class.js"></script>
	<script src="js/Instrument.js"></script>
	<script>

	var output = null;
	var socket = null;
	var reactor = null;
	var instruments = [Bass, Mid];
	var numInstruments = 0;

	function onload()
	{     
		output = document.getElementById('output');
		socket = io.connect('http://22.155.0.3:8000');
		clients = [];

		socket.on("connect", function() {

			socket.emit("id", "slave");
		});

		socket.on("cmd-client", function(data) {

			var delim = data.indexOf(":");
			var id = data.substr(0, delim);
			var body = data.substr(delim + 1);
			var instrument = getClientByID(id);

			switch(body)
			{

				case "down":
					instrument.playIntro();
					break;

				case "up":
					instrument.playOutro();
					break;

				case "disconnect":
					destroyClient(id);
					break;
			}

		});

	}     

	function getClientByID (id) {

		var instrument = clients[id];

		if (instrument == null) {

			instrument = createInstrument();
			clients[id] = instrument;
		}

		return instrument;
	}

	function destroyClient(id) {

		var instrument = clients[id];

		if (instrument != null) {

			numInstruments--;
			instrument.destroy();
			output.removeChild(instrument.element);
		}

		clients[id] = null;
		delete clients[id];
	}

	function createInstrument () {
		
		var instrument = new instruments[numInstruments]();
		output.appendChild(instrument.element);
		
		numInstruments++;
		return instrument;
	}	

	</script>
	<link rel="stylesheet" href="css/slave.css" />

	</head>
	<body onload="onload();">
		<div id="output"></div>
	</body>
</html>
