<html>
	<head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="audiosynth/audiosynth.js"></script>
	<script src="js/Class.js"></script>
	<script src="js/Instrument.js"></script>
	<script src="js/Note.js"></script>
	<script>

	var output = null;
	var socket = null;
	var reactor = null;

	var organ = Synth.createInstrument('organ');
	var bass = new Bass();

	function onload()
	{     

		output = document.getElementById('output');
		socket = io.connect('http://22.155.0.3:8000');
		clients = [];

		socket.on("connect", function() {

			socket.emit("id", "slave");

		});

		socket.on("cmd-client", function(data) {

			var delim = data.indexOf(":");
			var id = data.substr(0, delim);
			var body = data.substr(delim + 1);
			var client = getClientByID(id);

			switch(body)
			{

				case "down":
					organ.play.apply(organ, bass.intro.toArgs());
					client.className = 'instrument grow';
					break;

				case "up":
					organ.play.apply(organ, bass.outro.toArgs());
					client.className = 'instrument';
					break;

				case "disconnect":
					destroyClient(id);
					break;
			}


		});

	}     

	function getClientByID (id) 
	{
		var instrument = clients[id];
		if (instrument == null)
		{
			instrument = createInstrument();
			clients[id] = instrument;
		}
		return instrument;
	}

	function destroyClient(id)
	{
		var instrument = clients[id];

		if (instrument != null)
		{
			output.removeChild(instrument);
		}

		clients[id] = null;
		delete clients[id];
	}

	function createInstrument ()
	{
		var instrument = document.createElement('div');
		instrument.className = 'instrument';
		output.appendChild(instrument);
		instrument.style.marginLeft = String(clients.length * 200) + "px";

		return instrument;
	}	

	</script>
	<link rel="stylesheet" href="css/slave.css" />

	</head>
	<body onload="onload();">
		<div id="output"></div>
	</body>
</html>
